{% load static %}
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trade Dashboard</title>
    <!-- Link do Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Link do pliku CSS -->
    <link rel="stylesheet" href="{% static 'css/dashboard.css' %}">
</head>

<body>
    <!-- Nawigacja -->
    <nav class="navbar navbar-expand-lg navbar-dark">
        <div class="container-fluid">
            <a class="navbar-brand" href="#">Trade Dashboard</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"
                aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link active" href="{% url 'dashboard' %}">Dashboard</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#" id="open_journal_button">Open Journal</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#" id="open_strategies_button">My Strategies</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="{% url 'reports' %}">Go to Reports</a>
                    </li>
                    <li class="nav-item">
                        <form action="{% url 'logout' %}" method="post" class="d-inline">
                            {% csrf_token %}
                            <button type="submit" class="btn btn-outline-light btn-sm">Logout</button>
                        </form>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

 <div class="container mt-5">
    <h3 class="text-center mb-4">Trade Calculator</h3>
    <form method="POST" id="calculatorForm">
        {% csrf_token %}

        <table class="table table-bordered table-striped">
            <tbody>
                <tr>
                    <td><label for="currency">Currency:</label></td>
                    <td>
                        <select id="currency" name="currency" class="form-select">
                            {% for currency in currencies %}
                            <option value="{{ currency.code }}">{{ currency.code }}</option>
                            {% endfor %}
                        </select>
                    </td>
                </tr>
                <tr>
                    <td><label for="deposit">Main Deposit:</label></td>
                    <td><input type="number" step="any" id="deposit" name="deposit" class="form-control" required></td>
                </tr>
                <!-- Risk per trade i Risk Unit w jednej linii -->
                <tr>
                    <td><label for="risk">Risk per trade:</label></td>
                    <td>
                        <div class="d-flex">
                            <input type="number" step="any" id="risk" name="risk" class="form-control me-2" required>
                            <select id="risk_type" name="risk_type" class="form-select">
                                <option value="percent">%</option>
                                <option value="currency" id="currency_option"></option>
                            </select>
                        </div>
                    </td>
                </tr>
                <!-- Position Size i Position Unit w jednej linii -->
                <tr>
                    <td><label for="position">Position Size:</label></td>
                    <td>
                        <div class="d-flex">
                            <input type="number" step="any" id="position" name="position" class="form-control me-2" required>
                            <select id="position_type" name="position_type" class="form-select">
                                <option value="percent">%</option>
                                <option value="currency" id="position_currency_option"></option>
                            </select>
                        </div>
                    </td>
                </tr>
                <tr>
                    <td><label for="pair">Currency Pair:</label></td>
                    <td><input type="text" id="pair" name="pair" list="pairs" class="form-control" required>
                        <datalist id="pairs">
                            {% for pair in pairs %}
                            <option value="{{ pair.name }}">
                            {% endfor %}
                        </datalist>
                    </td>
                </tr>
                <tr>
                    <td><label for="trade_type">Trade Type:</label></td>
                    <td>
                        <select id="trade_type" name="trade_type" class="form-select" required>
                            <option value="long">Long</option>
                            <option value="short">Short</option>
                        </select>
                    </td>
                </tr>
                <tr>
                    <td><label for="entry">Entry Price:</label></td>
                    <td><input type="number" step="0.0001" id="entry" name="entry" class="form-control" required></td>
                </tr>
                <tr>
                    <td><label for="stop_loss">Stop Loss Price:</label></td>
                    <td><input type="number" step="any" id="stop_loss" name="stop_loss" class="form-control" required></td>
                </tr>
                <tr>
                    <td><label for="fee">Exchange Fee (%):</label></td>
                    <td><input type="number" step="0.0001" id="fee" name="fee" class="form-control" required></td>
                </tr>
                <!-- Target Mode (radio buttons) -->
                <tr>
                    <td><label>Target Mode:</label></td>
                    <td>
                        <label>
                            <input type="radio" name="target_mode" value="r" id="choose_ratio"> Choose Risk Ratio
                        </label><br>
                        <label>
                            <input type="radio" name="target_mode" value="custom_price" id="enter_exit_price"> Enter Exit Price
                        </label>
                    </td>
                </tr>
            </tbody>
        </table>

        <!-- Target selection field -->
        <div id="target_choice_wrapper" style="display:none;">
            <label for="target_choice">Choose Target:</label>
            <select id="target_choice" name="target_choice" required class="form-select">
                <option value="1R">1R</option>
                <option value="2R">2R</option>
                <option value="3R">3R</option>
            </select>
        </div>

        <!-- Custom exit price field, hidden by default -->
        <div id="custom_price_input" style="display:none;">
            <label for="custom_exit_price">Exit Price:</label>
            <input type="number" step="any" id="custom_exit_price" name="custom_exit_price" class="form-control">
        </div>

        <!-- Przyciski na dole formularza -->
        <div class="text-center mt-4">
            <button type="submit" class="btn btn-primary btn-lg" style="background-color: #343a40; border-color: #343a40;">Calculate</button>
            <button type="button" id="reset_button" class="btn btn-secondary btn-lg" style="background-color: #6c757d; border-color: #6c757d;">Start a New Project</button>
        </div>
    </form>
</div>



<!-- Results -->
<div id="results" style="display: none;">
    <p>Required Leverage</p>
    <p id="leverage"><span id="leverage_value"></span><span>x</span></p>

    <!-- Display chosen target and exit price -->
    <p>Selected Target: <span id="selected_target"></span></p>
    <table id="targets_table" style="display: none;">
        <thead>
            <tr>
                <th>Chosen Target</th>
                <th>Exit Price</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td id="chosenTarget"></td>
                <td id="chosenTargetPrice"></td>
                <td><span id="chosenTargetPriceCurrency"></span></td>
            </tr>
        </tbody>
    </table>

    <!-- Display predicted profit -->
    <p><strong>Predicted Profit:</strong> <span id="predicted_win"></span></p>

    <button type="button" id="add_to_journal_button">Add to Journal</button>

    <p>If the calculated leverage is unavailable for your pair, choose the maximum leverage from the list below, and the program will calculate the appropriate position size.</p>

    <button type="button" id="calculate_max_leverage_button" style="display: none;">Choose Max Leverage</button>

    <!-- Max leverage selection -->
    <label for="leverage_choice" style="display: none;" id="leverage_label">Choose Maximum Leverage:</label>
    <select id="leverage_choice" name="leverage_choice" style="display: none;">
        <option value="100">100x</option>
        <option value="75">75x</option>
        <option value="50">50x</option>
        <option value="25">25x</option>
        <option value="20">20x</option>
    </select>

    <div id="result_window" style="display: none; border: 1px solid black; padding: 10px; margin-top: 10px;">
        <h3>Result for Chosen Leverage:</h3>
        <p><strong>Chosen Leverage:</strong> <span id="display_selected_leverage"></span></p>
        <p><strong>Position Size:</strong> <span id="display_position_for_leverage"></span><span id="position_leverage_currency"></span></p>
    </div>
</div>

<button type="button" id="add_to_journal_max_leverage_button" style="display: none;">Add to Journal (Max Leverage)</button>

<div id="error_message" style="color: red;"></div>

<script type="module" src="{% static 'js/dashboard.js' %}"></script>
<script type="module" src="{% static 'js/journal_data.js' %}"></script>
